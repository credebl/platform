FROM node:18-slim

# Install pnpm
RUN npm install -g pnpm

# Install PostgreSQL client (use apt for Debian-based images)
RUN apt-get update && apt-get install -y postgresql-client

# Set working directory
WORKDIR /app

COPY . .

ENV PUPPETEER_SKIP_DOWNLOAD=true
RUN pnpm i --ignore-scripts

# Set the command to run the microservice
CMD ["sh", "-c", "cd libs/prisma-service && npx prisma migrate deploy && npx prisma generate && npx prisma db seed"]